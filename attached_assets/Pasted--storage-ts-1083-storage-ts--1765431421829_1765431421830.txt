–ü—Ä–æ–≤–µ—Ä–∏–ª –≤–µ—Å—å storage.ts (1083 —Å—Ç—Ä–æ–∫–∏). –í–æ—Ç –∏—Ç–æ–≥:

‚ùå –û–¢–°–£–¢–°–¢–í–£–Æ–©–ò–ï –º–µ—Ç–æ–¥—ã –≤ storage.ts:
–ú–µ—Ç–æ–¥	–î–ª—è —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞	–°—Ç–∞—Ç—É—Å
markMessageRead(messageId, userId)	/api/messages/:id/read	‚ùå –ù–µ—Ç
markChatRead(chatId, userId)	/api/chats/:id/read	‚ùå –ù–µ—Ç
savePushToken(userId, token)	/api/users/push-token POST	‚ùå –ù–µ—Ç
removePushToken(userId)	/api/users/push-token DELETE	‚ùå –ù–µ—Ç
‚úÖ –ö–æ–¥ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ storage.ts:
–î–æ–±–∞–≤—å—Ç–µ —ç—Ç–∏ –º–µ—Ç–æ–¥—ã –≤ –∫–ª–∞—Å—Å DatabaseStorage:

// Mark single message as read
async markMessageRead(messageId: number, userId: number): Promise<boolean> {
  const message = await this.getMessageById(messageId);
  if (!message) return false;
  
  const currentReadBy = message.readBy || [];
  if (currentReadBy.includes(userId)) return true; // Already read
  
  const newReadBy = [...currentReadBy, userId];
  
  const [updated] = await db
    .update(messages)
    .set({ readBy: newReadBy })
    .where(eq(messages.id, messageId))
    .returning();
  
  return !!updated;
}
// Mark all messages in chat as read by user
async markChatRead(chatId: number, userId: number): Promise<number> {
  // Get all unread messages in this chat (not sent by user, user not in readBy)
  const unreadMessages = await db
    .select()
    .from(messages)
    .where(
      and(
        eq(messages.chatId, chatId),
        not(eq(messages.senderId, userId))
      )
    );
  
  let markedCount = 0;
  for (const msg of unreadMessages) {
    const currentReadBy = msg.readBy || [];
    if (!currentReadBy.includes(userId)) {
      const newReadBy = [...currentReadBy, userId];
      await db
        .update(messages)
        .set({ readBy: newReadBy })
        .where(eq(messages.id, msg.id));
      markedCount++;
    }
  }
  
  return markedCount;
}
// Save push token for user
async savePushToken(userId: number, token: string): Promise<void> {
  await db
    .update(users)
    .set({ pushToken: token })
    .where(eq(users.id, userId));
}
// Remove push token for user
async removePushToken(userId: number): Promise<void> {
  await db
    .update(users)
    .set({ pushToken: null })
    .where(eq(users.id, userId));
}

‚ö†Ô∏è –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ schema.ts:
–ü–æ–ª–µ pushToken –≤ —Ç–∞–±–ª–∏—Ü–µ users ‚Äî –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç, –¥–æ–±–∞–≤–∏—Ç—å:
pushToken: text("push_token"),

–ü–æ–ª–µ readBy –≤ —Ç–∞–±–ª–∏—Ü–µ messages ‚Äî –≤–∏–∂—É —á—Ç–æ –æ–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –µ—Å—Ç—å:
readBy: integer("read_by").array().default([]),

üìã –¢–∞–∫–∂–µ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å IStorage:
markMessageRead(messageId: number, userId: number): Promise<boolean>;
markChatRead(chatId: number, userId: number): Promise<number>;
savePushToken(userId: number, token: string): Promise<void>;
removePushToken(userId: number): Promise<void>;